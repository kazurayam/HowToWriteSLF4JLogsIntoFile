= How to write SLF4J logs into file; i.e. How to customize Logback configuration in Katalon Studio

This is a link:https://katalon.com/katalon-studio[Katalon Studio] for demonstration purpose.
You can download the zip from the link:https://github.com/kazurayam/HowToWriteSLF4JLogsIntoFile/releases/[Releases] page on the GitHub.

This project was created using link:https://github.com/katalon-studio/katalon-studio/releases[version 8.3.0] but it should work on any versions.

I created this project in the hope that it can reply to an old question posted in the Katalon user forum at April 2019:

- link:https://forum.katalon.com/t/write-the-sl4j-logs-into-a-text-file/23332["Write the slf4j logs into a text file"]

== Problem to solve

In a Katalon Studio project, I created link:https://github.com/kazurayam/HowToWriteSLF4JLogsIntoFile/blob/develop/Scripts/runMyApp3/Script1683151952333.groovy[`Test Cases/runMyApps`]:

[source]
----
include::Scripts/runMyApp3/Script1683151952333.groovy[]
----

`runMyApps` calls a Groovy class.

- link:https://github.com/kazurayam/HowToWriteSLF4JLogsIntoFile/blob/develop/Keywords/com/kazurayam/myapp/MyApp3.groovy[`Keywords/com/kazurayam/myapp/MyApp3.groovy`]:

[source]
----
include::Keywords/com/kazurayam/myapp/MyApp3.groovy[]
----

This calls another Groovy class:

- link:https://github.com/kazurayam/HowToWriteSLF4JLogsIntoFile/blob/develop/Keywords/com/kazurayam/myapp/Foo.groovy[`Keywords/com/kazurayam/myapp/Foo.groovy`]

[source]
----
include::Keywords/com/kazurayam/myapp/Foo.groovy[]
----

If you read the source of the `Foo` class, you would notice that it generates quite a lot of logs (1000 lines) using the `org.slf4j.Logger`. And each line of log will be very long (3.8K characters actually). The size of log will be 1000 * 3.8K = 3.8Mega characters.

I rand the `Test Cases/runMyApp`. I got the following result:

image::https://kazurayam.github.io/HowToWriteSLF4JLogsIntoFile/images/01_log_lines_disappeared.png[]

In the Console tab of Katalon Studio, I expected to see 1000 lines of SLF4J logs from the `Foo` class. But actually I saw only the last part. Obviously, my `Foo` class emitted too much logs so that the logs exceeded the buffer size of the Console display.

I wanted to see the whole SLF4J logs from my application class. How can I manage it? --- **I want to write the SLF4J logs into a text file**.

== Solution

Katalon Studio uses the link:https://www.baeldung.com/slf4j-with-log4j2-logback[SLF4J with Logback].

In the offical Logback documentation, I found a sample code how to customize the Logback Logger while specifying XML conf file.

- link:https://logback.qos.ch/manual/configuration.html#joranDirectly[Chapter3 Configuration, Invoking JoranConfigurator directly]

Using this technique, I should be able to customize the `LoggingContext` of Logback so that the logs out of my Test Case to be written into a text file.

== Solution described

I have developed a Groovy class link:https://github.com/kazurayam/HowToWriteSLF4JLogsIntoFile/blob/develop/Keywords/com/kazurayam/ks/LoggerContextConfigurator.groovy[`com.kazurayam.ks.LoggerContextConfigurator`]

[source]
----
include:Keywords/com/kazurayam/ks/LoggerContextConfigurator.groovy[]
----

This code is almost identical to the sample code of Logback documentation. It overwrites the LoggerContext object as constructed by Katalon Studio while overwriting properties with the specified XML.

The class applies the following XML config as default.

- link:https://github.com/kazurayam/HowToWriteSLF4JLogsIntoFile/blob/develop/Include/config/logback-file.xml[]

[source]
----
include::Include/config/logback-file.xml[]
----

This XML declares  an Appender named `FILE`. And the `FILE` appender is applied to all classes of which fully-qualified-class-names starts with `com` at the log level of `debug`. For example, the following classes will be targeted:

- `com.kms.katalon.core.keyword.builtin.CommentKeyword`
- `com.kazurayam.myapp.Foo`

I included a file link:https://github.com/kazurayam/HowToWriteSLF4JLogsIntoFile/blob/develop/Include/config/logback-console.xml[`logback-console.xml`] which is the default Logback configuration used by Katalon Studio. It contains some handles for your  customization.


== How to run a demo

You want to create a Katalon Studio on your PC. Let me call it "test" test.

In the "test" project please create `Test Cases/runMyApp3`. You want to copy the above source and paste it into your Test Case.

Also please create `Keywords/myapp/MyApp3.groovy` and `Keywords/myapp/Foo.groovy`. You want to copy the above source and paste it into your Groovy class.

Now we start interesting portions.

Please visit the link:https://github.com/kazurayam/HowToWriteSLF4JLogsIntoFile/releases/[Releases] page of GitHub repository. You will find a link to a jar file named `LoggerContextConfigurator-x.x.x.jar`. Please download the jar file and save it into the `Drivers` folder of your local Katalon Studio project. The `Driver` folder would like this:

image::https://kazurayam.github.io/HowToWriteSLF4JLogsIntoFile/images/02_Drivers.png[]

Please create a file `Include/config/logback-file.xml`. The content of the file should be like the one as described above.

Please note the `com.kazurayam.ks.LoggerContextConfigurator` class knows the the path of the xml file to load.

Final step. You want to create a Test Listener.

- link:https://github.com/kazurayam/HowToWriteSLF4JLogsIntoFile/blob/develop/Test%40Listener/ConfigLogger.groovy[Test Listener/ConfigLogger.groovy]

[source]
----
include::Test Listeners/ConfigLogger.groovy[]
----

This Test Listener just calls the `LoggerContextConfigurator.configure()` when any Test Cases and Test Suites are invoked. Effectively the SLF4J `Logger` is customized so that it writes logs into file.

== Further customization

You can change the name of output log file as well as its location by modifying the xml file.

You can add new xml file and do whatever customization of SLF4J logging you want.

How to? --- Please read the code and find for yourself.
